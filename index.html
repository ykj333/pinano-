
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›¹ í”¼ì•„ë…¸ (AI ì‘ê³¡ ë„ìš°ë¯¸)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #2c3e50; /* ì–´ë‘ìš´ ë°°ê²½ìƒ‰ (ì´ë¯¸ì§€ ì°¸ê³ ) */
            margin: 0;
            padding: 1rem;
            touch-action: manipulation;
        }
        .piano-app-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #34495e; /* ì»¨í…Œì´ë„ˆ ë°°ê²½ */
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 900px; /* ìµœëŒ€ ë„ˆë¹„ ì¦ê°€ */
            padding: 25px;
        }
        .piano {
            display: flex;
            position: relative;
            background-color: #2c3e50;
            padding: 20px;
            border-radius: 8px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            overflow-x: auto;
            width: 100%;
            margin-bottom: 25px; /* AI ë„ìš°ë¯¸ ì„¹ì…˜ê³¼ì˜ ê°„ê²© */
        }
        .key {
            border: 1px solid #000;
            border-radius: 0 0 5px 5px;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.1s ease, transform 0.05s ease;
            flex-shrink: 0;
        }
        .key:active, .key.active {
            background-color: #ddd;
            transform: scale(0.98);
        }
        .white-key {
            width: 55px; /* í° ê±´ë°˜ ë„ˆë¹„ ì•½ê°„ ì¦ê°€ */
            height: 220px; /* í° ê±´ë°˜ ë†’ì´ ì•½ê°„ ì¦ê°€ */
            background-color: white;
            z-index: 1;
            margin-right: -1px;
        }
        .white-key:active, .white-key.active {
            background-color: #ccc;
        }
        .black-key {
            width: 33px; /* ê²€ì€ ê±´ë°˜ ë„ˆë¹„ ì•½ê°„ ì¦ê°€ */
            height: 130px; /* ê²€ì€ ê±´ë°˜ ë†’ì´ ì•½ê°„ ì¦ê°€ */
            background-color: #222; /* ê²€ì€ ê±´ë°˜ ìƒ‰ìƒ ë” ì–´ë‘¡ê²Œ */
            color: white;
            position: absolute;
            z-index: 2;
            margin-left: -17px; /* ìœ„ì¹˜ ì¡°ì • */
            border-radius: 0 0 4px 4px;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .black-key:active, .black-key.active {
            background-color: #444;
        }
        .key-label {
            position: absolute;
            bottom: 12px; /* ë ˆì´ë¸” ìœ„ì¹˜ ì¡°ì • */
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px; /* ë ˆì´ë¸” í°íŠ¸ í¬ê¸° ì•½ê°„ ì‘ê²Œ */
            color: #333;
            pointer-events: none;
        }
        .black-key .key-label {
            color: #ccc;
            font-size: 9px;
        }

        .ai-composer-assistant {
            background-color: #4a6179; /* AI ë„ìš°ë¯¸ ë°°ê²½ìƒ‰ */
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 20px;
        }
        .ai-composer-assistant h2 {
            color: #ecf0f1; /* ì œëª© ìƒ‰ìƒ */
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        .ai-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #56708c; /* ì„¹ì…˜ ë‚´ë¶€ ë°°ê²½ */
            border-radius: 6px;
        }
        .ai-section label {
            display: block;
            color: #bdc3c7; /* ë ˆì´ë¸” ìƒ‰ìƒ */
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        .ai-section select, .ai-section input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #7f8c8d;
            background-color: #ecf0f1; /* ì…ë ¥ í•„ë“œ ë°°ê²½ */
            color: #2c3e50; /* ì…ë ¥ í•„ë“œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            margin-bottom: 10px;
        }
        .ai-section button {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 5px;
        }
        .ai-section button.primary-action {
            background-color: #27ae60; /* ë…¹ìƒ‰ ë²„íŠ¼ (ì´ë¯¸ì§€ ì°¸ê³ ) */
        }
        .ai-section button.primary-action:hover {
            background-color: #229954;
        }
        .ai-section button.secondary-action {
            background-color: #f39c12; /* ì£¼í™©ìƒ‰ ë²„íŠ¼ (ì´ë¯¸ì§€ ì°¸ê³ ) */
        }
        .ai-section button.secondary-action:hover {
            background-color: #e67e22;
        }
         .ai-section button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .generated-content {
            background-color: #3e5267; /* ìƒì„±ëœ ì½˜í…ì¸  ë°°ê²½ */
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            color: #ecf0f1;
            font-size: 0.95rem;
            min-height: 30px;
            border: 1px dashed #7f8c8d;
        }

        .controls {
            margin-bottom: 20px; /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ê³¼ AI ë„ìš°ë¯¸ ì‚¬ì´ ê°„ê²© */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .controls button {
            padding: 10px 15px;
            border-radius: 6px;
            border: none;
            background-color: #3498db; /* ê¸°ì¡´ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ìƒ‰ìƒ */
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .controls button:hover {
            background-color: #2980b9;
        }
        .status-text {
            color: #bdc3c7;
            text-align: center;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.85);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            text-align: center;
            font-size: 1rem;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .loading-indicator { /* ë¡œë”© ì¸ë””ì¼€ì´í„° ìŠ¤íƒ€ì¼ ê°œì„  */
            color: #ecf0f1;
            font-size: 0.9rem;
            text-align: center;
            padding: 10px;
            display: none;
        }
    </style>
</head>
<body>

<div class="piano-app-container">
    <div class="piano" id="piano">
        </div>

    <div class="controls">
        <button id="octave-down">ì˜¥íƒ€ë¸Œ ë‚´ë¦¬ê¸°</button>
        <button id="octave-up">ì˜¥íƒ€ë¸Œ ì˜¬ë¦¬ê¸°</button>
        <span class="ml-4 text-white text-sm self-center">í˜„ì¬ ì˜¥íƒ€ë¸Œ: <span id="current-octave">4</span></span>
    </div>

    <div class="ai-composer-assistant">
        <h2>âœ¨ AI ì‘ê³¡ ë„ìš°ë¯¸</h2>

        <div class="ai-section">
            <label for="mood-selector">1. ë¶„ìœ„ê¸°ë¥¼ ì„ íƒí•˜ê³  ë©œë¡œë””ë¥¼ ìƒì„±í•´ ë³´ì„¸ìš”:</label>
            <select id="mood-selector">
                <option value="happy">í–‰ë³µí•œ (Happy)</option>
                <option value="sad">ìŠ¬í”ˆ (Sad)</option>
                <option value="calm">ì°¨ë¶„í•œ (Calm)</option>
                <option value="energetic">í™œê¸°ì°¬ (Energetic)</option>
                <option value="mysterious">ì‹ ë¹„ë¡œìš´ (Mysterious)</option>
            </select>
            <button id="generate-melody-ai" class="primary-action">+ AI ë©œë¡œë”” ìƒì„±</button>
            <div id="generated-melody-display" class="generated-content" placeholder="ìƒì„±ëœ ë©œë¡œë””ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></div>
            <button id="play-generated-melody" class="secondary-action mt-2" disabled>ìƒì„±ëœ ë©œë¡œë”” ì—°ì£¼</button>
        </div>

        <div class="ai-section">
            <label for="melody-input-for-chords">2. ì§§ì€ ë©œë¡œë””ë¥¼ ì…ë ¥í•˜ê³  ì½”ë“œ ì§„í–‰ì„ ì¶”ì²œ ë°›ì•„ë³´ì„¸ìš” (ì˜ˆ: C4 G4 E4 F4):</label>
            <input type="text" id="melody-input-for-chords" placeholder="ì—¬ê¸°ì— ìŒí‘œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: C4 E4 G4)">
            <button id="recommend-chords-ai" class="primary-action">+ AI ì½”ë“œ ì§„í–‰ ì¶”ì²œ</button>
            <div id="recommended-chords-display" class="generated-content" placeholder="ì¶”ì²œëœ ì½”ë“œ ì§„í–‰ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></div>
        </div>
        <div id="ai-loading-indicator" class="loading-indicator">AIê°€ ìƒê° ì¤‘... ğŸ¶</div>
    </div>
    <p class="status-text">í‚¤ë³´ë“œë¡œ ì—°ì£¼í•˜ê±°ë‚˜ ë§ˆìš°ìŠ¤ë¡œ í´ë¦­í•˜ì„¸ìš”.</p>
</div>

<div id="message-box" class="message-box"></div>

<script>
    // Tone.js ì‹ ë””ì‚¬ì´ì € ì„¤ì •
    const synth = new Tone.Synth().toDestination();
    // í´ë¦¬ì‹ ìŠ¤ (ì—¬ëŸ¬ ìŒ ë™ì‹œ ì¬ìƒ ê°€ëŠ¥) - ì½”ë“œ ì—°ì£¼ìš©
    const polySynth = new Tone.PolySynth(Tone.Synth).toDestination();


    const piano = document.getElementById('piano');
    const currentOctaveDisplay = document.getElementById('current-octave');
    const messageBox = document.getElementById('message-box');
    let currentOctave = 4;

    // --- AI ì‘ê³¡ ë„ìš°ë¯¸ ìš”ì†Œ ---
    const moodSelector = document.getElementById('mood-selector');
    const generateMelodyAiButton = document.getElementById('generate-melody-ai');
    const generatedMelodyDisplay = document.getElementById('generated-melody-display');
    const playGeneratedMelodyButton = document.getElementById('play-generated-melody');
    const melodyInputForChords = document.getElementById('melody-input-for-chords');
    const recommendChordsAiButton = document.getElementById('recommend-chords-ai');
    const recommendedChordsDisplay = document.getElementById('recommended-chords-display');
    const aiLoadingIndicator = document.getElementById('ai-loading-indicator');

    let lastGeneratedMelody = null; // ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ ë©œë¡œë”” ì €ì¥

    const keysData = [
        // ê¸°ì¡´ keysData ìœ ì§€
        { name: 'C', type: 'white', note: 'C', keyboardKey: 'a' }, { name: 'C#', type: 'black', note: 'C#', keyboardKey: 'w' },
        { name: 'D', type: 'white', note: 'D', keyboardKey: 's' }, { name: 'D#', type: 'black', note: 'D#', keyboardKey: 'e' },
        { name: 'E', type: 'white', note: 'E', keyboardKey: 'd' },
        { name: 'F', type: 'white', note: 'F', keyboardKey: 'f' }, { name: 'F#', type: 'black', note: 'F#', keyboardKey: 't' },
        { name: 'G', type: 'white', note: 'G', keyboardKey: 'g' }, { name: 'G#', type: 'black', note: 'G#', keyboardKey: 'y' },
        { name: 'A', type: 'white', note: 'A', keyboardKey: 'h' }, { name: 'A#', type: 'black', note: 'A#', keyboardKey: 'u' },
        { name: 'B', type: 'white', note: 'B', keyboardKey: 'j' },
        { name: 'C2', type: 'white', note: 'C', keyboardKey: 'k', nextOctave: true }
    ];

    function showMessage(message, duration = 3000) {
        messageBox.textContent = message;
        messageBox.style.display = 'block';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, duration);
    }

    function createPianoKeys() {
        piano.innerHTML = '';
        let whiteKeyIndex = 0;
        keysData.forEach(keyData => {
            const keyElement = document.createElement('div');
            keyElement.classList.add('key', keyData.type === 'white' ? 'white-key' : 'black-key');
            keyElement.dataset.note = keyData.note;
            keyElement.dataset.keyboardKey = keyData.keyboardKey;

            const keyLabel = document.createElement('span');
            keyLabel.classList.add('key-label');
            keyLabel.textContent = keyData.keyboardKey.toUpperCase();
            keyElement.appendChild(keyLabel);

            if (keyData.type === 'black') {
                keyElement.style.left = (whiteKeyIndex * 55 - 17) + 'px'; // ê±´ë°˜ ë„ˆë¹„ ë³€ê²½ì— ë”°ë¥¸ ìœ„ì¹˜ ì¡°ì •
            } else {
                whiteKeyIndex++;
            }

            const playNoteHandler = (event) => {
                event.preventDefault();
                const note = keyData.note;
                const octave = keyData.nextOctave ? currentOctave + 1 : currentOctave;
                const fullNote = note + octave;
                try {
                    synth.triggerAttackRelease(fullNote, "8n");
                    keyElement.classList.add('active');
                    setTimeout(() => keyElement.classList.remove('active'), 150);
                } catch (error) {
                    console.error("ìŒ ì¬ìƒ ì˜¤ë¥˜:", error);
                    showMessage("ìŒ ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            };
            keyElement.addEventListener('mousedown', playNoteHandler);
            keyElement.addEventListener('touchstart', playNoteHandler, { passive: false });
            piano.appendChild(keyElement);
        });
        currentOctaveDisplay.textContent = currentOctave;
    }

    function changeOctave(amount) {
        const newOctave = currentOctave + amount;
        if (newOctave >= 1 && newOctave <= 7) {
            currentOctave = newOctave;
            createPianoKeys();
        } else {
            showMessage(`ì˜¥íƒ€ë¸ŒëŠ” 1ê³¼ 7 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬: ${currentOctave}`);
        }
    }

    document.getElementById('octave-up').addEventListener('click', () => changeOctave(1));
    document.getElementById('octave-down').addEventListener('click', () => changeOctave(-1));

    document.addEventListener('keydown', (event) => {
        if (event.repeat || document.activeElement === melodyInputForChords) return; // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ í‚¤ë³´ë“œ ì—°ì£¼ ë°©ì§€
        const key = event.key.toLowerCase();
        const keyElement = document.querySelector(`.key[data-keyboard-key="${key}"]`);
        if (keyElement) {
            const note = keyElement.dataset.note;
            const keyData = keysData.find(kd => kd.keyboardKey === key);
            const octave = keyData.nextOctave ? currentOctave + 1 : currentOctave;
            const fullNote = note + octave;
            try {
                synth.triggerAttackRelease(fullNote, "8n");
                keyElement.classList.add('active');
            } catch (error) {
                console.error("ìŒ ì¬ìƒ ì˜¤ë¥˜ (í‚¤ë³´ë“œ):", error);
            }
        }
    });

    document.addEventListener('keyup', (event) => {
        if (document.activeElement === melodyInputForChords) return;
        const key = event.key.toLowerCase();
        const keyElement = document.querySelector(`.key[data-keyboard-key="${key}"]`);
        if (keyElement) {
            keyElement.classList.remove('active');
        }
    });

    // --- Gemini API í˜¸ì¶œ í•¨ìˆ˜ ---
    async function callGeminiAPI(prompt, buttonElement, loadingIndicatorElement, displayElement) {
        buttonElement.disabled = true;
        loadingIndicatorElement.style.display = 'block';
        displayElement.textContent = ''; // ì´ì „ ë‚´ìš© ì§€ìš°ê¸°

        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = ""; // Canvas í™˜ê²½ì—ì„œ ìë™ ì œê³µ
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status}. ì‘ë‹µ: ${errorBody}`);
            }
            const result = await response.json();

            if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                const generatedText = result.candidates[0].content.parts[0].text;
                displayElement.textContent = generatedText;
                return generatedText; // ìƒì„±ëœ í…ìŠ¤íŠ¸ ë°˜í™˜
            } else {
                console.error("Gemini API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜:", result);
                displayElement.textContent = "ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆì–´ìš”. ì‘ë‹µì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
                return null;
            }
        } catch (error) {
            console.error("Gemini API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜:", error);
            displayElement.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message.substring(0,100)}...`;
            return null;
        } finally {
            buttonElement.disabled = false;
            loadingIndicatorElement.style.display = 'none';
        }
    }

    // 1. AI ë©œë¡œë”” ìƒì„±
    generateMelodyAiButton.addEventListener('click', async () => {
        const mood = moodSelector.value;
        const prompt = `Create a very simple and short (4 to 6 notes) musical melody suitable for a beginner piano player.
The mood should be '${mood}'. The melody should be primarily in C major or A minor.
Provide only the notes as a sequence with octave numbers (e.g., C4 E4 G4 A4). Do not add any other text or explanation.`;

        const melody = await callGeminiAPI(prompt, generateMelodyAiButton, aiLoadingIndicator, generatedMelodyDisplay);
        if (melody) {
            lastGeneratedMelody = melody.trim().split(/\s+/); // ê³µë°± ê¸°ì¤€ìœ¼ë¡œ ìŒí‘œ ë¶„ë¦¬
            playGeneratedMelodyButton.disabled = false;
            showMessage("âœ¨ AIê°€ ë©œë¡œë””ë¥¼ ìƒì„±í–ˆì–´ìš”!", 2000);
        } else {
            playGeneratedMelodyButton.disabled = true;
            lastGeneratedMelody = null;
        }
    });

    // ìƒì„±ëœ ë©œë¡œë”” ì—°ì£¼
    playGeneratedMelodyButton.addEventListener('click', () => {
        if (lastGeneratedMelody && lastGeneratedMelody.length > 0) {
            const now = Tone.now();
            lastGeneratedMelody.forEach((note, index) => {
                // ìœ íš¨í•œ ìŒí‘œ í˜•ì‹ì¸ì§€ ê°„ë‹¨íˆ í™•ì¸ (ì˜ˆ: C4, F#5)
                if (/^[A-Ga-g]#?[0-9]$/.test(note)) {
                    try {
                         synth.triggerAttackRelease(note, "8n", now + index * 0.5); // 0.5ì´ˆ ê°„ê²©ìœ¼ë¡œ ì—°ì£¼
                    } catch (e) {
                        console.error(`ì˜ëª»ëœ ìŒí‘œ í˜•ì‹ ë˜ëŠ” ì—°ì£¼ ì˜¤ë¥˜: ${note}`, e);
                        showMessage(`ë©œë¡œë”” ì—°ì£¼ ì¤‘ ì˜¤ë¥˜: ${note}ëŠ” ì˜ëª»ëœ ìŒí‘œì…ë‹ˆë‹¤.`, 2000);
                        // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì—°ì£¼ ì¤‘ë‹¨ ë˜ëŠ” ë‹¤ìŒ ìŒí‘œë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬
                        return; // í˜„ì¬ forEach ë°˜ë³µ ì¤‘ë‹¨í•˜ê³  ë‹¤ìŒ ìŒí‘œë¡œ
                    }
                } else {
                    console.warn(`ê±´ë„ˆë›´ ìŒí‘œ (í˜•ì‹ ì˜¤ë¥˜): ${note}`);
                }
            });
            showMessage("ğŸ¶ ìƒì„±ëœ ë©œë¡œë””ë¥¼ ì—°ì£¼í•©ë‹ˆë‹¤.", (lastGeneratedMelody.length * 0.5 + 1) * 1000);
        } else {
            showMessage("ë¨¼ì € AI ë©œë¡œë””ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.", 2000);
        }
    });


    // 2. AI ì½”ë“œ ì§„í–‰ ì¶”ì²œ
    recommendChordsAiButton.addEventListener('click', async () => {
        const inputMelody = melodyInputForChords.value.trim();
        if (!inputMelody) {
            showMessage("ë¨¼ì € ë©œë¡œë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: C4 G4 E4 F4)", 2000);
            return;
        }

        // ì…ë ¥ëœ ë©œë¡œë”” ìŒí‘œ ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨í•˜ê²Œ)
        const notes = inputMelody.split(/\s+/);
        const validNotes = notes.filter(note => /^[A-Ga-g]#?[0-9]$/.test(note));
        if (validNotes.length === 0) {
            showMessage("ìœ íš¨í•œ ìŒí‘œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: C4 G4 E4 F4)", 2500);
            return;
        }
        const validatedInputMelody = validNotes.join(" ");


        const prompt = `Given a short melody: "${validatedInputMelody}", suggest a simple chord progression (2 to 4 chords) that would fit well.
The chords should be common and suitable for a beginner.
Provide only the chord names as a sequence (e.g., C G Am F). Do not add any other text or explanation.`;

        const chords = await callGeminiAPI(prompt, recommendChordsAiButton, aiLoadingIndicator, recommendedChordsDisplay);
        if (chords) {
            showMessage("âœ¨ AIê°€ ì½”ë“œ ì§„í–‰ì„ ì¶”ì²œí–ˆì–´ìš”!", 2000);
            // ì—¬ê¸°ì— ì¶”ì²œëœ ì½”ë“œë¥¼ ì—°ì£¼í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (polySynth ì‚¬ìš©)
            // ì˜ˆ: playRecommendedChords(chords.trim().split(/\s+/));
        }
    });

    // (ì„ íƒ ì‚¬í•­) ì¶”ì²œëœ ì½”ë“œ ì—°ì£¼ í•¨ìˆ˜ (polySynth ì‚¬ìš©)
    /*
    function playRecommendedChords(chordsArray) {
        if (!chordsArray || chordsArray.length === 0) return;
        const now = Tone.now();
        // ê°„ë‹¨í•œ ì½”ë“œ-ìŒí‘œ ë§¤í•‘ (ë” ì •êµí•œ ë¡œì§ í•„ìš”)
        const chordToNotes = {
            'C': ['C4', 'E4', 'G4'], 'G': ['G4', 'B4', 'D5'],
            'Am': ['A4', 'C5', 'E5'], 'F': ['F4', 'A4', 'C5'],
            // ë” ë§ì€ ì½”ë“œ ì¶”ê°€ ê°€ëŠ¥
        };
        chordsArray.forEach((chordName, index) => {
            const notesInChord = chordToNotes[chordName];
            if (notesInChord) {
                polySynth.triggerAttackRelease(notesInChord, "1n", now + index * 1.0); // 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ì½”ë“œ ì—°ì£¼
            }
        });
    }
    */


    // ì´ˆê¸°í™”
    createPianoKeys();

    async function startToneContext() {
        try {
            if (Tone.context.state !== 'running') {
                await Tone.start();
                console.log("Tone.js ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì‹œì‘ë¨");
                showMessage("í”¼ì•„ë…¸ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¹", 2500);
            }
        } catch (error) {
            console.error("Tone.js ì‹œì‘ ì˜¤ë¥˜:", error);
            showMessage("ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.", 3000);
        }
    }

    window.addEventListener('load', startToneContext);
    document.body.addEventListener('click', startToneContext, { once: true });
    document.body.addEventListener('touchstart', startToneContext, { once: true });

</script>
</body>
</html>
